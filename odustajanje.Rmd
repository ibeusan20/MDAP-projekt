---
title: "Predikcija odustajanja uÄenika"
output:
  html_document:
    df_print: paged
---
```{r}

options(repos = c(CRAN = "https://cran.r-project.org"))

library(dplyr)
df <- read.csv("data.csv", sep = ";")

# Prilagodba naziva varijabli
names(df) <- make.names(names(df))

# Pogled prvih par redova
head(df)

# Struktura podataka
str(df)

```

```{r}
# SaÅ¾etak skupa podataka:
# Kratak saÅ¾etak svih varijabli
summary(df)

# Detaljan opis po tipu (kvantitativne, kvalitativne)
library(skimr)
skim(df)

```

Skup podataka sastoji se od 3820 opservacija i 37 varijabli, ukljuÄujuÄ‡i osobne, akademske i socijalno-ekonomske karakteristike studenata. Varijabla Target predstavlja ciljnu varijablu koja klasificira studente kao "Dropout", "Enrolled" ili "Graduate".
Podaci ukljuÄuju numeriÄke varijable (npr. Admission.grade, Age.at.enrollment, GDP) i kategorizirane cjelobrojne varijable koje predstavljaju Å¡ifre ili klasifikacije (npr. Gender, Course, Father's.qualification).


### Definiranje podskupa od 1500 opservacija sa stratificiranim omjerima po varijabli Target
```{r}
# Raspodjela klasa u originalnom skupu
table(df$Target)
prop.table(table(df$Target))  # relativne frekvencije

# Broj opservacija u podskupu
N <- 1500

# Stratificirano uzorkovanje
set.seed(123)  # reproducibilnost

library(dplyr)

df_sample <- df %>%
  group_by(Target) %>%
  sample_frac(size = N / nrow(df)) %>%
  ungroup()

# Provjera rezultata
table(df_sample$Target)
prop.table(table(df_sample$Target))
nrow(df_sample) # cca. 1500

```
| Klasifikacija | Originalno | Uzorak | Omjer u originalu | Omjer u uzorku |
| ------------- | ---------- | ------ | -------------- | ------------ |
| **Dropout**   | 1421       | 482    | 32.12%         | 32.13%       |
| **Enrolled**  | 794        | 269    | 17.95%         | 17.93%       |
| **Graduate**  | 2209       | 749    | 49.93%         | 49.93%       |
| **Ukupno**    | 4424       | 1500   | 100%           | 100%         |


Kako bismo smanjili dimenzionalnost skupa podataka i ubrzali analizu, konstruiran je stratificirani uzorak od 1500 opservacija.
Pri tome je zadrÅ¾ana izvorna raspodjela ciljne varijable Target koja sadrÅ¾i tri klase: "Dropout", "Enrolled" i "Graduate".
Tako konstruirani uzorak reprezentativan je s obzirom na ishode studenata te je prikazan gornjom tablicom.

## Deskriptivna statistika

Iako su mnoge varijable bile zapisane kao cijeli brojevi (int), temeljem opisa podataka one predstavljaju kategorizirane informacije (npr. braÄni status, spol, razina obrazovanja roditelja) te su stoga konvertirane u factor tip u R-u.
Time se omoguÄ‡uje ispravna analiza, vizualizacija i interpretacija. Varijable koje mjere koliÄine (npr. ocjene, broj upisanih predmeta) zadrÅ¾ane su kao kvantitativne varijable (numeric).

## Kvantitativne varijable
```{r}
kvantitativne <- c(
  "Previous.qualification..grade.",
  "Admission.grade",
  "Age.at.enrollment",
  "Curricular.units.1st.sem..grade.",
  "Curricular.units.2nd.sem..grade.",
  "Unemployment.rate",
  "Inflation.rate",
  "GDP",
  "Curricular.units.1st.sem..credited.",
  "Curricular.units.1st.sem..enrolled.",
  "Curricular.units.1st.sem..evaluations.",
  "Curricular.units.1st.sem..approved.",
  "Curricular.units.1st.sem..without.evaluations.",
  "Curricular.units.2nd.sem..credited.",
  "Curricular.units.2nd.sem..enrolled.",
  "Curricular.units.2nd.sem..evaluations.",
  "Curricular.units.2nd.sem..approved.",
  "Curricular.units.2nd.sem..without.evaluations."
)

```
```{r}
# Desktiptivna statistika kvant. varijabli:
df_kv <- df_sample[, kvantitativne]
library(dplyr)

deskriptiva_kv <- df_kv %>%
  summarise_all(list(
    Srednja = mean,
    Medijan = median,
    SD = sd,
    Q1 = ~quantile(., 0.25),
    Q3 = ~quantile(., 0.75),
    Min = min,
    Max = max
  ), na.rm = TRUE)

# Transponiranje za preglednost
deskriptiva_kv_t <- t(deskriptiva_kv)

# Prikaz tablice
knitr::kable(deskriptiva_kv_t, digits = 2,
             col.names = c("Srednja", "Medijan", "SD", "Q1", "Q3", "Min", "Max"),
             caption = "Deskriptivna statistika kvantitativnih varijabli")
```
```{r}
# GrafiÄki prikaz histograma:
library(ggplot2)

for (var in kvantitativne) {
  print(
    ggplot(df_sample, aes_string(x = var)) +
      geom_histogram(fill = "steelblue", color = "black", bins = 30) +
      labs(title = paste("Histogram varijable:", var), x = var, y = "Frekvencija") +
      theme_minimal()
  )
}

```
```{r}
# GrafiÄki prikaz boxplotova:
for (var in kvantitativne) {
  print(
    ggplot(df_sample, aes_string(y = var)) +
      geom_boxplot(fill = "darkorange", color = "black") +
      labs(title = paste("Boxplot varijable:", var), y = var) +
      theme_minimal()
  )
}

```

Na temelju 18 kvantitativnih varijabli iz podskupa, provedena je deskriptivna statistika i grafiÄka analiza distribucije.
IzraÄunate su mjere centralne tendencije i disperzije (srednja vrijednost, medijan, SD, kvartili), kao i ekstremne vrijednosti (min, max).
Histogrami prikazuju oblik distribucije podataka, dok boxploti dodatno vizualiziraju raspon i moguÄ‡a odstupanja (strÅ¡ila).


## Kvalitativne varijable
```{r}
kvalitativne <- c(
  "Marital.status", "Application.mode", "Application.order", "Course",
  "Daytime.evening.attendance.", "Previous.qualification", "Nacionality",
  "Mother.s.qualification", "Father.s.qualification", "Mother.s.occupation",
  "Father.s.occupation", "Displaced", "Educational.special.needs", "Debtor",
  "Tuition.fees.up.to.date", "Gender", "Scholarship.holder", "International",
  "Target"
)
# Pretvorba za lakÅ¡u analizu:
# Pretvori kvalitativne varijable u factor
df_sample[, kvalitativne] <- lapply(df_sample[, kvalitativne], as.factor)
# Provjera: sve bi trebale sada imati ispravan tip
str(df_sample)
```

```{r}
# Desktiptivna statistika kval. varijabli:
# Za svaku varijablu ispis moda i frekvencijske distribucije
for (var in kvalitativne) {
  cat("ğŸ”¹ Varijabla:", var, "\n")
  mod_value <- names(sort(table(df_sample[[var]]), decreasing = TRUE))[1]
  cat("   Mod:", mod_value, "\n")
  print(sort(table(df_sample[[var]]), decreasing = TRUE))
  cat("\n")
}

```

```{r}
# GrafiÄki prikaz â€“ stupÄasti dijagram za svaku kvalitativnu varijablu:
library(ggplot2)

for (var in kvalitativne) {
  plot_data <- as.data.frame(table(df_sample[[var]]))
  colnames(plot_data) <- c("Kategorija", "Frekvencija")
  
  print(
    ggplot(plot_data, aes(x = reorder(Kategorija, -Frekvencija), y = Frekvencija)) +
      geom_bar(stat = "identity", fill = "darkgreen") +
      labs(title = paste("Barplot za varijablu:", var), x = var, y = "Frekvencija") +
      theme_minimal() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1))
  )
}

```

Kvalitativne varijable analizirane su pomoÄ‡u frekvencijskih distribucija i moda / najÄeÅ¡Ä‡e vrijednosti.
Za svaku varijablu izraÄunata je uÄestalost pojavljivanja svih kategorija, a najfrekventnija vrijednost definirana je kao mod.
Vizualizacija je izvedena pomoÄ‡u stupÄastih dijagrama, gdje se jasno uoÄavaju dominantne kategorije.

## Odnos izmeÄ‘u numeriÄkih varijabli

```{r}
#install.packages("corrplot")
#install.packages("GGally")
#install.packages("dplyr")
#install.packages("reshape2")

library(corrplot)
library(GGally)
library(dplyr)
library(reshape2)


```
### Korelacijska matrica numeriÄkih varijabli:
```{r korelacijska-matrica, fig.width=12, fig.height=12}
# SkraÄ‡eni nazivi (ruÄno prilagoÄ‘eni za preglednost)
kratki_nazivi <- c(
  "Prev.Grade", "Adm.Grade", "Age.Enroll",
  "1st.Grade", "2nd.Grade", "Unemp.Rate", "Infl.Rate", "GDP",
  "1st.Cred", "1st.Enroll", "1st.Eval", "1st.Approv", "1st.NoEval",
  "2nd.Cred", "2nd.Enroll", "2nd.Eval", "2nd.Approv", "2nd.NoEval"
)

# Priprema podatkaka i korelacijske matrice
df_kv <- df_sample[, kvantitativne]
colnames(df_kv) <- kratki_nazivi

korelacija <- cor(df_kv, use = "complete.obs")

# Prikaz Äitke matrice
library(corrplot)
corrplot(korelacija, method = "color", type = "lower",
         tl.col = "black", tl.srt = 45,
         addCoef.col = "black", number.cex = 0.8, diag = FALSE)


korelacija <- cor(df_kv, use = "complete.obs")

# Pretvorba korelacijske matrice u long-format tablicu
library(reshape2)
korelacija_long <- melt(korelacija)
colnames(korelacija_long) <- c("Var1", "Var2", "Correlation")

# Filtriraj samo razliÄite parove (izbaci duplikate i dijagonalu)
korelacija_long <- korelacija_long[korelacija_long$Var1 != korelacija_long$Var2, ]
korelacija_long <- korelacija_long[!duplicated(apply(korelacija_long[,1:2], 1, paste, collapse = "_")), ]

# PrikaÅ¾i jake pozitivne korelacije (>= 0.7)
korelacija_jaka_poz <- korelacija_long %>%
  filter(Correlation >= 0.7)

# PrikaÅ¾i jake negativne korelacije (<= -0.3)
korelacija_jaka_neg <- korelacija_long %>%
  filter(Correlation <= -0.3)

# IspiÅ¡i rezultate
korelacija_jaka_poz
korelacija_jaka_neg

```

Plava boja oznaÄava pozitivnu korelaciju, dok crvena negativnu. Å to je korelacija bliÅ¾a nuli to je viÅ¡e bijela. Slijede neka od tumaÄenja s grafa:

| Varijable                  | Korelacija | ZnaÄenje                                               |
| -------------------------- | ---------- | ------------------------------------------------------ |
| `1st.Approv` â€“ `1st.Grade` | **0.71**   | ViÅ¡e ocjene povezane s veÄ‡im brojem poloÅ¾enih predmeta |
| `2nd.Approv` â€“ `2nd.Grade` | **0.75**   | Isto u drugom semestru                                 |
| `1st.Enroll` â€“ `1st.Cred`  | **0.76**   | Broj upisanih i priznatih predmeta snaÅ¾no povezan      |
| `2nd.Enroll` â€“ `2nd.Cred`  | **0.74**   | Isto u drugom semestru                                 |
| `1st.Eval` â€“ `1st.Enroll`  | **0.76**   | ViÅ¡e evaluacija Å¡to je viÅ¡e predmeta                   |
| `2nd.Eval` â€“ `2nd.Enroll`  | **0.77**   | Isto u drugom semestru                                 |

1. Povezanost ocjena i prolaznosti

| Varijabla 1 | Varijabla 2  | Korelacija | TumaÄenje                                                                    |
| ----------- | ------------ | ---------- | ---------------------------------------------------------------------------- |
| `1st.Grade` | `2nd.Grade`  | **0.837**  | Studenti s dobrim ocjenama u 1. semestru imaju sliÄan uspjeh i u 2. semestru |
| `1st.Grade` | `1st.Approv` | **0.710**  | Å to je viÅ¡e predmeta poloÅ¾eno viÅ¡i je prosjek                                 |
| `2nd.Grade` | `1st.Approv` | **0.702**  | Raniji uspjeh povezan je s kasnijim ocjenama                               |
| `2nd.Grade` | `2nd.Approv` | **0.777**  | Povezanost poloÅ¾enih predmeta i ocjene u 2. semestru                         |

2. Upisanost i priznavanje kolegija

| Varijabla 1  | Varijabla 2  | Korelacija | TumaÄenje                                         |
| ------------ | ------------ | ---------- | ------------------------------------------------- |
| `1st.Enroll` | `1st.Cred`   | **0.759**  | ViÅ¡e prijavljenih predmeta rezultira viÅ¡e priznatih predmeta       |
| `2nd.Cred`   | `1st.Cred`   | **0.943**  | Priznavanja u 1. i 2. semestru visoko povezana    |
| `1st.Cred`   | `2nd.Cred`   | **0.943**  | Broj ocijenjenih predmeta u 1. semestru se nastavlja i u drugom semestru |
| `2nd.Enroll` | `1st.Enroll` | **0.940**  | Broj prijavljenih predmeta stabilan kroz semestre |

3. Evaluacije i prolaznosti

| Varijabla 1  | Varijabla 2  | Korelacija | TumaÄenje                                         |
| ------------ | ------------ | ---------- | ------------------------------------------------- |
| `1st.Eval`   | `2nd.Eval`   | **0.772**  | ViÅ¡e evaluacija u 1. semestru â†’ viÅ¡e i u 2.       |
| `2nd.Approv` | `1st.Approv` | **0.900**  | Broj poloÅ¾enih kolegija vrlo sliÄan kroz semestre |

Analiza Pearsonovih koeficijenata korelacije pokazala je izuzetno jake pozitivne veze izmeÄ‘u varijabli koje opisuju akademsku izvedbu.
Navedeno ukazuje na dosljedan obrazac ponaÅ¡anja i uspjeha studenata kroz vrijeme.
Takvi odnosi sugeriraju da se akademska uspjeÅ¡nost moÅ¾e predvidjeti i modelirati uz relativno mali broj pouzdanih indikatora, buduÄ‡i da postoji visoka meÄ‘uovisnost meÄ‘u njima.

### Dijagrami rasprÅ¡enja 

```{r}
library(ggplot2)
library(dplyr)

kvantitativne <- df_sample %>% select(where(is.numeric)) %>% colnames()

df_num <- df_sample[, c(kvantitativne, "Target")]

df_num$Target <- as.factor(df_num$Target)

for (var in kvantitativne) {
  p <- ggplot(df_num, aes_string(x = "Target", y = var, color = "Target")) +
    geom_jitter(width = 0.2, alpha = 0.5) +
    geom_boxplot(alpha = 0.3, outlier.shape = NA) +
    theme_minimal() +
    labs(title = paste("Distribucija varijable:", var),
         x = "Ishod studenta (Target)",
         y = var) +
    theme(legend.position = "none")

  print(p)
}

```
Za svaku numeriÄku varijablu izraÄ‘en je scatterplot u odnosu na ishod studija (Target).
GrafiÄki prikazi ukazuju na razlike u distribuciji vrijednosti izmeÄ‘u studenata koji su diplomirali, odustali ili joÅ¡ studiraju.


```{r ggpairs-matrica, fig.width=14, fig.height=14}
# manji podskup radi preglednosti (npr. 6 varijabli)
colnames(df_kv) <- kratki_nazivi
GGally::ggpairs(df_kv[, 1:8])
#GGally::ggpairs(df_kv)


```
Zbog duljine naziva varijabli, koriÅ¡teni su skraÄ‡eni identifikatori u prikazu korelacijske matrice i dijagrama rasprÅ¡enja. Time se osigurava bolja preglednost i razumljivost rezultata bez gubitka znaÄenja.

Korelacijska matrica pokazuje Pearsonove koeficijente linearne povezanosti izmeÄ‘u svih kvantitativnih varijabli.
Koeficijenti se kreÄ‡u izmeÄ‘u -1 i 1, gdje:

vrijednosti blizu +1 oznaÄavaju jaku pozitivnu korelaciju,

vrijednosti blizu -1 oznaÄavaju jaku negativnu korelaciju,

vrijednosti oko 0 ukazuju na slab ili nepostojeÄ‡i linearni odnos.

Dijagrami rasprÅ¡enja dodatno ilustriraju linearnost i eventualne nelinearne obrasce meÄ‘u varijablama.


## Kvalitativne 

## Provjera nedostajuÄ‡ih vrijednosti
```{r}
# Ukupan broj NA po varijabli
colSums(is.na(df_sample))

# Postotak NA po varijabli
na_pct <- colMeans(is.na(df_sample)) * 100
na_pct[na_pct > 0]

```

## Provjera dupliciranih zapisa

```{r}
# Broj potpuno identiÄnih redaka
#sum(duplicated(df_sample))

# Ispis prvih nekoliko duplikata, ako postoje
#df_sample[duplicated(df_sample), ][1:5, ]

```

U danom setu podataka nema nedostajuÄ‡ih vrijednosti niti ima dupliciranih vrijednosti.

## Provjera ekstremnih vrijednosti (Outliers)
```{r}
# Definiranje outliera po IQR
detect_outliers_iqr <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  (x < (Q1 - 1.5 * IQR)) | (x > (Q3 + 1.5 * IQR))
}

# Primjena na sve kvantitativne varijable
outlier_summary <- sapply(df_sample[ , kvantitativne], function(col) sum(detect_outliers_iqr(col)))
outlier_summary[outlier_summary > 0]

```

Na sljedeÄ‡im boxplotovima crveni krugovi oznaÄavaju identificirane ekstremne vrijednosti.
Vizualizacija je ograniÄena samo na one varijable koje imaju barem jedan outlier.

```{r}
# Petlja za crtanje boxplotova za sve kvantitativne varijable
par(mfrow = c(1, 1))
for (var in kvantitativne) {
  boxplot(df_sample[[var]],
          main = var,
          ylab = "Vrijednost",
          col = "lightblue",
          border = "darkblue",
          outcol = "red")
}
par(mfrow = c(1, 1))

```
Identificirani su outlieri u viÅ¡e numeriÄkih varijabli (npr. Admission.grade, Age.at.enrollment, Curricular.units...). VeÄ‡ina ekstremnih vrijednosti predstavlja realne, ali rijetke sluÄajeve (npr. studenti stariji od 60 godina, studenti s ocjenom 0 ili 20).

#### Postupanje:

Ako je vrijednost semantiÄki opravdana i odraÅ¾ava stvarni sluÄaj onda se zadrÅ¾ava u skupu.

Ako je vrijednost statistiÄki ekstremna i nelogiÄna (npr. broj evaluacija je veÄ‡i od normalnog raspona) onda se oznaÄava za dodatnu analizu i moguÄ‡e uklanjanje.

Ako se outlier nalazi u binarnoj varijabli, zadrÅ¾ava se, jer doprinosi klasifikacijskim analizama.


#2. faza


### Korelacijska matrica i dijagrami rasipanja

# Odabir numeriÄkih varijabli za korelaciju

```{r}
##num_vars <- df %>% select_if(is.numeric)
num_vars <- df_sample[, kvantitativne] #veÄ‡ napravljeno kao df_kv ali eto da se vidi opet...
```

Analiza: U ovom koraku izdvajamo samo kvantitativne (numeriÄke) varijable iz skupa podataka. To je vaÅ¾no jer korelacijska analiza ima smisla samo za numeriÄke varijable. Time osiguravamo da u daljnjim analizama ne ukljuÄujemo kvalitativne (kategorijske) podatke koji bi mogli iskriviti rezultate.

# Korelacijska matrica
```{r}
cor_matrix <- cor(num_vars, use = "complete.obs")
round(cor_matrix, 2)
```

Analiza: Korelacijska matrica prikazuje meÄ‘usobne linearne odnose izmeÄ‘u svih numeriÄkih varijabli. Vrijednosti blizu 1 ili -1 ukazuju na snaÅ¾nu pozitivnu ili negativnu korelaciju, dok vrijednosti blizu 0 ukazuju na slab ili nikakav linearni odnos. Ova analiza pomaÅ¾e identificirati varijable koje su meÄ‘usobno povezane, Å¡to moÅ¾e biti korisno za odabir prediktora u daljnjim modelima.


# Vizualizacija korelacijske matrice (veÄ‡ postoji ranije u radu)
```{r}
library(corrplot)
corrplot::corrplot(cor_matrix, method = "color", tl.cex = 0.7)
```

Analiza: Vizualizacija korelacijske matrice pomoÄ‡u 'corrplot' funkcije omoguÄ‡uje brzu identifikaciju snaÅ¾nih i slabih korelacija izmeÄ‘u varijabli. Boje i intenzitet kvadrata olakÅ¡avaju uoÄavanje obrazaca i potencijalnih problema s viÅ¡e kolinearnoÅ¡Ä‡u, Å¡to je vaÅ¾no za kasnije modeliranje.


# Dijagrami rasipanja za najvaÅ¾nije varijable
```{r}
pairs(~ Admission.grade + Age.at.enrollment + Curricular.units.1st.sem..grade. + Curricular.units.2nd.sem..grade., data = df, main = "Scatterplot matrix")
```

Analiza: Dijagrami rasipanja (scatterplot matrix) omoguÄ‡uju vizualnu procjenu odnosa izmeÄ‘u parova najvaÅ¾nijih varijabli. Ovdje moÅ¾emo uoÄiti postoji li linearna ili nelinearna veza, te identificirati eventualne outliere ili obrasce koji bi mogli utjecati na rezultate regresije.


### Priprema podataka za logistiÄku regresiju

```{r}
# Smanjujemo Target na dvije klase: Dropout vs. ostali (Graduate/Enrolled)
df$Dropout <- ifelse(df$Target == "Dropout", 1, 0)

table(df$Dropout)
prop.table(table(df$Dropout)) * 100


```

Analiza: Ovdje redefiniramo ciljnu varijablu tako da imamo binarnu klasifikaciju: 1 oznaÄava studente koji su odustali, a 0 one koji su diplomirali ili su joÅ¡ upisani. Time pojednostavljujemo problem i omoguÄ‡ujemo primjenu logistiÄke regresije. Tablica prikazuje distribuciju klasa, Å¡to je vaÅ¾no za procjenu uravnoteÅ¾enosti skupa podataka.
Ova distribucija pokazuje da je skup podataka umjereno neuravnoteÅ¾en, s veÄ‡im brojem studenata koji nisu odustali (~ 68%).
UnatoÄ neuravnoteÅ¾enosti, omjer klasa je dovoljno dobar za pouzdano treniranje logistiÄkog modela bez potrebe za dodatnim tehnikama balansiranja.

# Odabir prediktora na temelju korelacija i domene
```{r}
model_data <- df %>% select(Dropout, Admission.grade, Age.at.enrollment, Gender, Curricular.units.1st.sem..grade., Curricular.units.2nd.sem..grade.)
model_data <- na.omit(model_data)

```

Analiza: Za modeliranje biramo varijable koje su prema korelacijskoj analizi i struÄnoj procjeni najrelevantnije za predviÄ‘anje odustajanja. Uklanjanjem redaka s nedostajuÄ‡im vrijednostima (na.omit) osiguravamo da model ne bude pristran zbog nepotpunih podataka.
Odabrane varijable ukljuÄuju ocjenu pri upisu (Admission.grade), dob pri upisu (Age.at.enrollment), spol (Gender) te prosjeÄne ocjene iz prvog i drugog semestra. Ove varijable su identificirane kao relevantne kroz kombinaciju domenskog znanja i rezultata korelacijske matrice. KoriÅ¡tenjem ovih prediktora model ima potencijal prepoznati obrazovne i demografske obrasce koji ukazuju na poveÄ‡ani rizik od odustajanja.


### LogistiÄka regresija
```{r}
model <- glm(Dropout ~ ., data = model_data, family = binomial)
summary(model)

# Napravi predikciju ako joÅ¡ nisi
model_data$pred <- predict(model, type = "response")

# Ukloni NA ako ih ima
model_data <- model_data[complete.cases(model_data$Dropout, model_data$pred), ]

# IzraÄunaj ROC
library(pROC)
roc_obj <- roc(model_data$Dropout, model_data$pred)
plot(roc_obj, col = "blue", main = "ROC krivulja")
auc(roc_obj)


```

Analiza: Za potrebe regresijske analize, odabrana je varijabla Target kao zavisna varijabla. BuduÄ‡i da se radi o kvalitativnoj varijabli s tri razine (Dropout, Enrolled, Graduate), za binarnu logistiÄku regresiju transformirana je u novu varijablu Dropout (1 = Dropout, 0 = ostali). Time se omoguÄ‡ava modeliranje vjerojatnosti odustajanja studenata u odnosu na sve ostale ishode.
LogistiÄka regresija modelira vjerojatnost odustajanja na temelju odabranih prediktora. Izlaz summary(model) daje procjene koeficijenata, njihove standardne pogreÅ¡ke, z-vrijednosti i p-vrijednosti. Koeficijenti pokazuju smjer i snagu utjecaja svake varijable na vjerojatnost odustajanja. P-vrijednosti nam govore koje su varijable statistiÄki znaÄajne.

ROC krivulja prikazuje kompromis izmeÄ‘u osjetljivosti (sensitivity) i specifiÄnosti (specificity) klasifikacijskog modela. AUC (Area Under the Curve) predstavlja ukupnu sposobnost modela da ispravno klasificira primjere: vrijednosti blizu 1 ukazuju na izvrstan model, dok vrijednosti blizu 0.5 ukazuju na nasumiÄno pogaÄ‘anje. U naÅ¡em sluÄaju, AUC = 0.8371, Å¡to ukazuje na vrlo dobru (>0.8) klasifikacijsku sposobnost. Takav rezultat sugerira da model moÅ¾e sluÅ¾iti kao koristan alat za prepoznavanje riziÄnih studenata prije nego odustanu.


# IzraÄun omjera izgleda (odds ratio)
```{r}
exp(coef(model))
```

Analiza: Omjeri izgleda (odds ratio) interpretiraju se kao promjena u omjeru vjerojatnosti odustajanja za jedinicu promjene prediktora. Vrijednosti veÄ‡e od 1 ukazuju na poveÄ‡anje rizika od odustajanja, dok vrijednosti manje od 1 ukazuju na smanjenje rizika.

Admission.grade (omjer izgleda ~ 0.99): za svaku jedinicu veÄ‡u ocjenu pri upisu, vjerojatnost odustajanja se smanjuje za otprilike 1% (jer je OR < 1). Pokazuje da su bolji kandidati manje skloni odustajanju.

Age.at.enrollment (omjer izgleda ~ 1.06): stariji studenti imaju 6% veÄ‡u Å¡ansu za odustajanje po svakoj godini starosti. MoÅ¾e ukazivati na dodatne Å¾ivotne obaveze (posao, obitelj).

Gender (omjer izgleda ~ 1.70): ovisno o kodiranju, jedna skupina (najÄeÅ¡Ä‡e muÅ¡karci ako je muÅ¡ki = 1) ima 70% veÄ‡u Å¡ansu za odustajanje. VaÅ¾no je jasno specificirati kodiranje varijable Gender u dokumentaciji.

Curricular.units.1st.sem..grade. (omjer izgleda ~ 1.007): efekt je vrlo blizu 1 i nije statistiÄki znaÄajan (p-vrijednost), Å¡to sugerira da ocjene u 1. semestru ne pridonose znaÄajno modelu kada su druge varijable prisutne.

Curricular.units.2nd.sem..grade. (omjer izgleda ~ 0.78): bolji uspjeh u drugom semestru smanjuje rizik od odustajanja za 22% po jedinici ocjene. Ovo je snaÅ¾an i znaÄajan zaÅ¡titni faktor.

Interpretacija omjera izgleda omoguÄ‡uje kvantificiranje efekta svake varijable na ishod. U kontekstu obrazovne politike, rezultati sugeriraju da akademski uspjeh i pripremljenost pri upisu (Admission.grade, 2nd.sem.grade) igraju kljuÄnu ulogu, dok demografski faktori (dob, spol) takoÄ‘er nose znaÄajnu teÅ¾inu.

# Signifikantnost modela
```{r}
anova(model, test = "Chisq")
```

Analiza:
ANOVA tablica s Chi-kvadrat testiranjem (tipiÄna za generalizirane linearne modele) prikazuje sekvencijalni doprinos svake varijable smanjenju devijance modela. Devijanca je mjera "pogreÅ¡ke" modela â€“ niÅ¾a vrijednost devijance znaÄi bolju prilagodbu podacima.

Za svaki prediktor navodi se:
Df - broj stupnjeva slobode (1 po varijabli)
Deviance - koliki doprinos ima ta varijabla u smanjenju ukupne devijance modela
Pr(>Chi) - p-vrijednost za testiranje hipoteze da varijabla ne doprinosi znaÄajno

TumaÄenje po varijabli:
Admission.grade (p ~ 1.3e-10) - znaÄajno doprinosi: Å¡to je viÅ¡a ulazna ocjena, manja je Å¡ansa za odustajanje.
Age.at.enrollment (p < 2.2e-16) - iznimno znaÄajan prediktor: dob ima snaÅ¾nu povezanost s ishodom.
Gender (p < 2.2e-16) - spol takoÄ‘er statistiÄki znaÄajno utjeÄe na ishod.
Curricular.units.1st.sem..grade. (p < 2.2e-16) - ovdje pokazuje jako veliki doprinos modelu.
Curricular.units.2nd.sem..grade. (p < 2.2e-16) - jasno znaÄajna varijabla s velikim doprinosom modelu.

ZakljuÄak:
Sve ukljuÄene varijable daju znaÄajan doprinos modelu u kontekstu testiranja smanjenja devijance. To potvrÄ‘uje da je odabir prediktora opravdan i da model ima snaÅ¾nu statistiÄku osnovu. Dodatno, visoke Chi-kvadrat vrijednosti i niske p-vrijednosti pokazuju da model ne ukljuÄuje beskorisne varijable i da svaka od njih znaÄajno pridonosi razdvajanju skupina (Dropout vs. ostali).


# Predikcija i evaluacija modela
```{r}
model_data$pred <- predict(model, type = "response")
model_data$pred_class <- ifelse(model_data$pred > 0.5, 1, 0)

table(Predicted = model_data$pred_class, Actual = model_data$Dropout)
```

Analiza: Model generira vjerojatnosti odustajanja za svakog studenta. Klasifikacija se vrÅ¡i pragom od 0.5. Tablica prikazuje koliko je model toÄno predvidio odustajanje i ostanak, Å¡to omoguÄ‡uje procjenu toÄnosti i eventualnih problema s laÅ¾no pozitivnim/negativnim predviÄ‘anjima.
TumaÄenje:
TN (True Negative) = 2845 studenata je ispravno klasificirano kao neodustali.
TP (True Positive) = 740 je ispravno klasificirano kao odustali.
FP (False Positive) = 158 je krivo oznaÄeno kao odustali iako nisu.
FN (False Negative) = 681 je model krivo oznaÄio kao da nisu odustali, a jesu.

MoguÄ‡e evaluacijske metrike:

ToÄnost (Accuracy):
\frac{TP + TN}{TP + TN + FP + FN} = \frac{2845 + 740}{4424} ~ {81.3%}
--> Dobra ukupna toÄnost, ali moÅ¾e biti varljiva kod neuravnoteÅ¾enih klasa
Preciznost (Precision):
\frac{TP}{TP + FP} = \frac{740}{740 + 158} ~ {82.4%}
--> Koliko je predikcija "odustao" zaista bila toÄna.
Odziv (Recall/Sensitivity):
\frac{TP}{TP + FN} = \frac{740}{740 + 681} ~ {52.1%}
--> Koliki postotak od stvarnih "dropout" je model uhvatio.
F1-mjera:
F1 = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}} ~ {63.7%}
--> UravnoteÅ¾en pokazatelj izmeÄ‘u preciznosti i odziva.

Model je relativno precizan u predviÄ‘anju odustajanja (visoka preciznost), ali ima umjeren odziv odnosno propustio je dio stvarno odustalih studenata. To moÅ¾e biti problem u praksi, jer studenti koji su stvarno u riziku moÅ¾da neÄ‡e biti prepoznati.

# IzraÄun toÄnosti
```{r}
model_data$pred <- predict(model, type = "response")
model_data$pred_class <- ifelse(model_data$pred > 0.5, 1, 0)
mean(model_data$pred_class == model_data$Dropout)

```

Analiza: ToÄnost modela predstavlja udio ispravno klasificiranih sluÄajeva. (ToÄno klasificirano odustajanje i toÄno klasificirano "ostajanje" podijeljeno s ukupnim brojem promatranja) u ovom sluÄaju ~ 80.88%. Visoka toÄnost ukazuje na dobru prediktivnu sposobnost modela, ali treba biti oprezan kod neuravnoteÅ¾enih klasa â€“ tada je korisno dodatno analizirati metrike poput preciznosti, odziva i F1-mjere.

PreporuÄljivo je ukljuÄiti i :
Preciznost (Precision): Koliko je toÄnih meÄ‘u onima za koje je model rekao da su odustali.
Odziv (Recall): Koliki postotak stvarno odustalih studenata je model uspio otkriti.
F1-mjeru: HarmoniÄnu sredinu preciznosti i odziva, koja posebno dolazi do izraÅ¾aja kada su klase neuravnoteÅ¾ene.


```{r}
# install.packages("caret")
library(caret)

confusionMatrix(factor(model_data$pred_class), factor(model_data$Dropout), positive = "1")

```
Analiza: Analiza rezultata proÅ¡irene evaluacije modela binarne logistiÄke regresije ukljuÄuje kljuÄne klasifikacijske metrike koje nadopunjuju samu toÄnost i pruÅ¾aju dublji uvid u uÄinkovitost modela, osobito u kontekstu neuravnoteÅ¾enih klasa.

Dobivena toÄnost (Accuracy) iznosi 81.04%, Å¡to znaÄi da je model u prosjeku ispravno klasificirao viÅ¡e od Äetiri od pet sluÄajeva. MeÄ‘utim, s obzirom da No Information Rate (NIR) iznosi 67.88% (tj. model koji bi uvijek predviÄ‘ao najÄeÅ¡Ä‡u klasu bio bi toÄan u gotovo 68% sluÄajeva), naÅ¡ model znaÄajno nadmaÅ¡uje to osnovno predviÄ‘anje (p < 2.2e-16), Å¡to potvrÄ‘uje njegovu korisnost.

Pogledamo li preciznost (Precision, ili Pos Pred Value), model toÄno predviÄ‘a odustajanje za 82.41% sluÄajeva kada kaÅ¾e da je student odustao. To znaÄi da je model priliÄno dobar u izbjegavanju laÅ¾no pozitivnih predikcija (npr. oznaÄavanje studenta kao odustalog kad to nije).

S druge strane, odziv (Recall, ili Sensitivity) iznosi 52.08%, Å¡to implicira da je model prepoznao otprilike polovicu svih stvarno odustalih studenata. To je osjetljiva toÄka modela, jer bi u nekim kontekstima bilo poÅ¾eljno postiÄ‡i viÅ¡i odziv, Äak i pod cijenu neÅ¡to niÅ¾e preciznosti.

F1-mjera, koja balansira preciznost i odziv, indirektno se moÅ¾e procijeniti iz prikazanih vrijednosti, i bila bi korisna za dodatnu kvantifikaciju ravnoteÅ¾e izmeÄ‘u laÅ¾no pozitivnih i laÅ¾no negativnih sluÄajeva. Nadalje, visoka specifiÄnost (Specificity) od 94.74% pokazuje da je model vrlo uspjeÅ¡an u identifikaciji studenata koji nisu odustali.

Na kraju, Kappa koeficijent od 0.5184 ukazuje na umjerenu dobru slaganja izmeÄ‘u predikcija modela i stvarnih vrijednosti, dok Balanced Accuracy (prosjek specifiÄnosti i osjetljivosti) iznosi 73.41%, Å¡to dodatno potvrÄ‘uje solidnu, iako ne savrÅ¡enu, sposobnost modela da se nosi s neuravnoteÅ¾enim klasama.

U cjelini, model pokazuje dobru klasifikacijsku sposobnost, ali postoji prostor za poboljÅ¡anja, osobito u pogledu osjetljivosti (odaziva), Å¡to je osobito vaÅ¾no ako je cilj proaktivna identifikacija ugroÅ¾enih studenata.

### Interpretacija rezultata

Komentar: Prikazani su koeficijenti modela, njihova signifikantnost i omjeri izgleda. VaÅ¾no je interpretirati koji prediktori znaÄajno utjeÄu na vjerojatnost odustajanja. TakoÄ‘er, prikazana je toÄnost modela i matrica klasifikacije.

Preporuka: Analizirati rezidualne dijagnostiÄke grafove (plot(model)) i razmotriti dodatne varijable ili interakcije ako je potrebno.

### Rezultati binarne logistiÄke regresije pokazuju:

Admission.grade: Negativan i signifikantan koeficijent (omjer izgleda ~ 0.99) upuÄ‡uje da veÄ‡a ocjena pri upisu smanjuje vjerojatnost odustajanja.

Age.at.enrollment: Pozitivan i signifikantan (omjer izgleda ~ 1.06) - stariji studenti ÄeÅ¡Ä‡e odustaju.

Gender: Pozitivan i signifikantan (omjer izgleda ~ 1.70) â†’ muÅ¡karci imaju veÄ‡u Å¡ansu za odustajanje.

Curricular.units.2nd.sem..grade.: Negativan i snaÅ¾no signifikantan (omjer izgleda ~ 0.78) - bolje ocjene u 2. semestru smanjuju rizik od odustajanja.

Curricular.units.1st.sem..grade.: Nije znaÄajan â€“ moguÄ‡e je da varijabla ne doprinosi dodatno uz ostale prediktore.

Model ima AUC = 0.837, Å¡to prema klasifikaciji Hosmer-Lemeshow sugerira vrlo dobru diskriminacijsku sposobnost modela (0.8â€“0.9 = "very good"). MeÄ‘utim, neÅ¡to niÅ¾i recall (52%) ukazuje da bi model mogao propustiti dio stvarnih odustajanja, Å¡to moÅ¾e imati praktiÄne implikacije ako je cilj prevencija.

### ZakljuÄak

Model logistiÄke regresije omoguÄ‡uje identifikaciju kljuÄnih faktora povezanih s odustajanjem studenata. NajznaÄajniji prediktori su Admission.grade, Age.at.enrollment i uspjeh u prvoj i drugoj godini. Model ima odreÄ‘enu prediktivnu snagu, ali je preporuÄljivo dodatno testirati i validirati model na novim podacima.

### Literatura
1. R documentation: https://www.r-project.org/
2. Corrplot package: https://cran.r-project.org/web/packages/corrplot/
3. Literatura iz kolegija i znanstveni Älanci o studentskoj odustajnosti


